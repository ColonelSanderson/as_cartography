<%= setup_context(:object => @transfer, :title => @transfer.title) %>

<%= form_for @transfer, :as => "transfer", :url => {:action => :update}, :html => {:class => 'form-horizontal aspace-record-form', :id => "transfer_form"}.merge(update_monitor_params(@transfer)) do |f| %>
    <%= form_context :transfer, @transfer do |form| %>
        <div class="row">
            <div class="col-md-3">
                <%= render_aspace_partial :partial => "sidebar" %>
            </div>

            <div class="col-md-9">
                <%= render_aspace_partial :partial => "transfers/toolbar" %>
                <div class="record-pane">
                    <%= render_aspace_partial :partial => "shared/form_messages", :locals => {:object => @transfer, :form => form} %>

                    <%= link_to_help :topic => "transfer" %>
                    <%= render_aspace_partial :partial => "transfers/form", :locals => {:form => form} %>

                    <% define_template "transfer_edit", jsonmodel_definition(:transfer) do |form, transfer| %>
                        <section id="transfer_checklist" class="subrecord-form transfer-checklist">
                            <h3 class="subrecord-form-heading-label"><%= I18n.t("transfer._frontend.section.checklist") %></h3>
                            <div class="transfer_checklist_item">
                                <input type="checkbox" id="checklist_metadata_received" name="transfer[checklist_metadata_received]" value="true" <% if @transfer.checklist_metadata_received %>checked<% end %>>
                                <label class="form-check-label" for="checklist_metadata_received"><%= I18n.t("transfer.checklist.metadata_received") %></label>
                            </div>

                            <div class="transfer_checklist_item">
                                <input type="checkbox" id="checklist_rap_received" name="transfer[checklist_rap_received]" value="true" <% if @transfer.checklist_rap_received %>checked<% end %>>
                                <label class="form-check-label" for="checklist_rap_received"><%= I18n.t("transfer.checklist.rap_received") %></label>
                            </div>

                            <div class="transfer_checklist_item">
                                <input type="checkbox" id="checklist_metadata_approved" name="transfer[checklist_metadata_approved]" value="true" <% if @transfer.checklist_metadata_approved %>checked<% end %>>
                                <label class="form-check-label" for="checklist_metadata_approved"><%= I18n.t("transfer.checklist.metadata_approved") %></label>
                            </div>

                            <div class="transfer_checklist_item">
                                <input type="checkbox" id="checklist_transfer_received" name="transfer[checklist_transfer_received]" value="true" <% if @transfer.checklist_transfer_received %>checked<% end %>>
                                <label class="form-check-label" for="checklist_transfer_received"><%= I18n.t("transfer.checklist.transfer_received") %></label>
                            </div>
                        </section>

                        <% unless ASUtils.wrap(@transfer['files']).empty? %>
                            <section id="transfer_files_">
                                <h3 class="subrecord-form-heading-label"><%= I18n.t("transfer._frontend.section.files") %></h3>
                                <table class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th><%= I18n.t("transfer.files.filename") %></th>
                                            <th><%= I18n.t("transfer.files.mime_type") %></th>
                                            <th><%= I18n.t("transfer.files.role") %></th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% Array(@transfer['files']).each do |file, idx| %>
                                            <% form.push("files[#{idx}]") do |form| %>

                                                <tr>
                                                    <td><%= file.fetch('filename') %></td>
                                                    <td><%= file.fetch('mime_type') %></td>
                                                    <td>
                                                        <%= form.hidden_input('key', file.fetch('key')) %>
                                                        <%= form.label_and_select('role', form.possible_options_for(['files', 'role']), :field_opts => {:default => file.fetch('role')}) %>
                                                    </td>
                                                    <td class="table-record-actions">
                                                        <div class="btn-group">
                                                            <%=
                                                            link_to(I18n.t("transfer.files.view"),
                                                                    {
                                                                        :controller => :transfer_files,
                                                                        :action => :show,
                                                                        :key => file.fetch('key'),
                                                                        :filename => file.fetch('filename'),
                                                                        :mime_type => file.fetch('mime_type'),
                                                                    },
                                                                    {
                                                                        :class => "btn btn-primary"
                                                                    })
                                                            %>
                                                        </div>
                                                    </td>
                                                </tr>
                                            <% end %>
                                        <% end %>
                                    </tbody>
                                </table>
                            </section>
                        <% end %>


                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary"><%= I18n.t("transfer._frontend.action.save") %></button>
                            <%= link_to I18n.t("actions.cancel"), :back, :class => "btn btn-cancel btn-default" %>
                        </div>
                    <% end %>

                    <%= form.emit_template "transfer_edit" %>
                </div>
            </div>
        </div>
    <% end %>
<% end %>
