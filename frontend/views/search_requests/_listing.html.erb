<%#
  This template override is unusual.. but turns out any listing with /search
  in the path results in custom behaviour that we are unable to disable.

  So, instead this has to happen. Sorry.
%>

<% if @search_data.results? %>
  <% add_identifier_column if show_identifier_column? %>
  <%= render_aspace_partial :partial => "shared/pagination_summary" %>

  <table id="tabledSearchResults" class="table table-striped table-bordered table-condensed table-hover table-sortable table-search-results">
    <thead>
    <tr>
      <th class="col title sortable <% if @search_data.sorted_by === "title_sort"%>sort-<%= @search_data.current_sort_direction %><% end %>">
        <%= link_to title_column_header_label, build_search_params("sort" => @search_data.sort_filter_for("title_sort")) %>
      </th>
      <th class="col"><%= I18n.t("search_request.status") %></th>
      <th class="col"><%= I18n.t("search_request.agency") %></th>
      <th class="col audit-info"></th>
      <th class="col actions"><!-- actions --></th>
    </tr>
    </thead>
    <tbody>
    <% @search_data['results'].each do |result|
      deleted = (params.has_key?("deleted_uri") and Array(params["deleted_uri"]).include?(result["id"])) || false
      parsed = ASUtils.json_parse(result['json'])
    %>
      <tr class="<%= "deleted" if deleted %>">
        <td>
          <% if deleted %><span class="label label-important"><%= I18n.t("states.deleted") %></span><% end %>
          <%=  clean_mixed_content(result["title"]).html_safe %>
        </td>
        <td><%= parsed.fetch('status', '') %></td>
        <td>
          <%= parsed.fetch('agency', {}).fetch('_resolved', {}).fetch('display_name', {}).fetch('sort_name', '') %>
        </td>
        <td>
          <%= display_audit_info(result, :format => 'compact') %>
        </td>
        <td class="table-record-actions">
          <% if not deleted %>
            <div class="btn-group">
              <%= link_to I18n.t("actions.view"), {:controller => :resolver, :action => :resolve_readonly, :uri => result["id"]}, :class => "btn btn-xs btn-default" %>
            </div>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
  <%= render_aspace_partial :partial => "shared/pagination" %>
<% else %>
  <p class="alert alert-info">
    <%= I18n.t("search_results.no_results") %>
  </p>
<% end %>
